import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useEffect, useState, useCallback } from 'react';
import { motion } from 'framer-motion';
import Sidebar from '../components/Sidebar';
import VelocityChart from '../components/charts/VelocityChart';
import TaskDonutChart from '../components/charts/TaskDonutChart';
import { RoadmapProgress } from '../components/charts/ProgressBar';
import { useAuthStore } from '../store/auth';
export default function ExecutiveDashboard() {
    const [metrics, setMetrics] = useState(null);
    const [velocityTrend, setVelocityTrend] = useState([]);
    const [teamProductivity, setTeamProductivity] = useState([]);
    const [blockedTasks, setBlockedTasks] = useState([]);
    const [overdueItems, setOverdueItems] = useState([]);
    const [criticalBugs, setCriticalBugs] = useState([]);
    const [products, setProducts] = useState([]);
    const [epics, setEpics] = useState([]);
    const [loading, setLoading] = useState(true);
    const [lastUpdated, setLastUpdated] = useState('');
    const { token } = useAuthStore();
    const fetchData = useCallback(async () => {
        try {
            const headers = { Authorization: `Bearer ${token}` };
            const [dashboardRes, velocityRes, teamRes, blockersRes, productsRes, roadmapRes] = await Promise.all([
                fetch('/api/executive/dashboard', { headers }),
                fetch('/api/executive/velocity-trend', { headers }),
                fetch('/api/executive/team-productivity', { headers }),
                fetch('/api/executive/blockers', { headers }),
                fetch('/api/executive/products', { headers }),
                fetch('/api/executive/roadmap', { headers }),
            ]);
            const [dashboardData, velocityData, teamData, blockersData, productsData, roadmapData] = await Promise.all([
                dashboardRes.json(),
                velocityRes.json(),
                teamRes.json(),
                blockersRes.json(),
                productsRes.json(),
                roadmapRes.json(),
            ]);
            setMetrics(dashboardData.metrics);
            setLastUpdated(dashboardData.lastUpdated);
            setVelocityTrend(velocityData.velocityTrend || []);
            setTeamProductivity(teamData.teamProductivity || []);
            setBlockedTasks(blockersData.blockedTasks || []);
            setOverdueItems(blockersData.overdueItems || []);
            setCriticalBugs(blockersData.criticalBugs || []);
            setProducts(productsData.products || []);
            setEpics(roadmapData.roadmap || []);
        }
        catch (err) {
            console.error('Failed to fetch executive data', err);
        }
        finally {
            setLoading(false);
        }
    }, [token]);
    useEffect(() => {
        fetchData();
        // Auto-refresh every 5 minutes
        const interval = setInterval(fetchData, 5 * 60 * 1000);
        return () => clearInterval(interval);
    }, [fetchData]);
    const formatTime = (isoString) => {
        const date = new Date(isoString);
        return date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
    };
    if (loading) {
        return (_jsxs("div", { className: "h-screen flex overflow-hidden bg-slate-50 dark:bg-slate-950", children: [_jsx(Sidebar, {}), _jsx("main", { className: "flex-1 flex items-center justify-center", children: _jsxs("div", { className: "text-center", children: [_jsxs("div", { className: "relative", children: [_jsx("div", { className: "animate-spin rounded-full h-16 w-16 border-4 border-slate-200 dark:border-slate-800 border-t-primary mx-auto" }), _jsx("span", { className: "absolute inset-0 flex items-center justify-center", children: _jsx("span", { className: "material-symbols-outlined text-primary text-xl", children: "monitoring" }) })] }), _jsx("p", { className: "mt-4 text-slate-600 dark:text-slate-400 font-medium", children: "Loading Executive Dashboard..." })] }) })] }));
    }
    const taskDistribution = [
        { label: 'To Do', value: metrics?.todoTasks || 0, color: '#64748b' },
        { label: 'In Progress', value: metrics?.inProgressTasks || 0, color: '#3b82f6' },
        { label: 'Review', value: metrics?.reviewTasks || 0, color: '#f59e0b' },
        { label: 'Done', value: metrics?.completedTasks || 0, color: '#10b981' },
        { label: 'Blocked', value: metrics?.blockedTasks || 0, color: '#ef4444' },
    ];
    const staggerContainer = {
        hidden: { opacity: 0 },
        show: {
            opacity: 1,
            transition: { staggerChildren: 0.05 },
        },
    };
    const fadeInUp = {
        hidden: { opacity: 0, y: 20 },
        show: { opacity: 1, y: 0 },
    };
    return (_jsxs("div", { className: "h-screen flex overflow-hidden bg-slate-50 dark:bg-slate-950", children: [_jsx(Sidebar, {}), _jsxs("main", { className: "flex-1 flex flex-col overflow-hidden", children: [_jsxs("header", { className: "h-16 px-6 border-b border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 flex items-center justify-between shrink-0", children: [_jsx("div", { className: "flex items-center gap-4", children: _jsxs("div", { className: "flex items-center gap-3", children: [_jsx("div", { className: "size-10 rounded-xl bg-gradient-to-br from-violet-600 to-indigo-600 flex items-center justify-center text-white shadow-lg shadow-violet-500/25", children: _jsx("span", { className: "material-symbols-outlined text-[22px]", children: "monitoring" }) }), _jsxs("div", { children: [_jsx("h2", { className: "text-lg font-bold text-slate-900 dark:text-white", children: "Executive Overview" }), _jsx("p", { className: "text-xs text-slate-500 dark:text-slate-400", children: "Real-time project health and metrics" })] })] }) }), _jsxs("div", { className: "flex items-center gap-4", children: [_jsxs("div", { className: "flex items-center gap-2 text-sm text-slate-500 dark:text-slate-400", children: [_jsx("span", { className: "material-symbols-outlined text-[18px]", children: "schedule" }), _jsxs("span", { children: ["Updated ", lastUpdated ? formatTime(lastUpdated) : 'now'] })] }), _jsxs("button", { onClick: fetchData, className: "flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-slate-600 dark:text-slate-300 hover:text-primary dark:hover:text-primary hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors", children: [_jsx("span", { className: "material-symbols-outlined text-[18px]", children: "refresh" }), "Refresh"] })] })] }), _jsx("div", { className: "flex-1 overflow-auto p-6", children: _jsxs(motion.div, { variants: staggerContainer, initial: "hidden", animate: "show", className: "space-y-6 max-w-[1800px] mx-auto", children: [_jsxs(motion.div, { variants: fadeInUp, className: "grid grid-cols-4 gap-4", children: [_jsx("div", { className: "bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-5 shadow-sm", children: _jsxs("div", { className: "flex items-start justify-between", children: [_jsxs("div", { children: [_jsx("p", { className: "text-sm font-medium text-slate-500 dark:text-slate-400", children: "Story Points" }), _jsxs("div", { className: "mt-2 flex items-baseline gap-2", children: [_jsx("span", { className: "text-3xl font-bold text-slate-900 dark:text-white tabular-nums", children: metrics?.completedPoints || 0 }), _jsxs("span", { className: "text-lg text-slate-400 dark:text-slate-500", children: ["/ ", metrics?.totalStoryPoints || 0] })] }), _jsx("div", { className: "mt-2 w-full h-1.5 bg-slate-100 dark:bg-slate-800 rounded-full overflow-hidden", children: _jsx("div", { className: "h-full bg-gradient-to-r from-emerald-500 to-emerald-400 rounded-full transition-all duration-500", style: { width: `${metrics?.totalStoryPoints ? (metrics.completedPoints / metrics.totalStoryPoints) * 100 : 0}%` } }) })] }), _jsx("div", { className: "size-10 rounded-lg bg-emerald-100 dark:bg-emerald-900/30 flex items-center justify-center", children: _jsx("span", { className: "material-symbols-outlined text-emerald-600 dark:text-emerald-400", children: "analytics" }) })] }) }), _jsx("div", { className: "bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-5 shadow-sm", children: _jsxs("div", { className: "flex items-start justify-between", children: [_jsxs("div", { children: [_jsx("p", { className: "text-sm font-medium text-slate-500 dark:text-slate-400", children: "Active Sprints" }), _jsx("div", { className: "mt-2 flex items-baseline gap-2", children: _jsx("span", { className: "text-3xl font-bold text-slate-900 dark:text-white tabular-nums", children: metrics?.activeSprintCount || 0 }) }), _jsxs("p", { className: "mt-2 text-xs text-slate-500 dark:text-slate-400", children: [metrics?.inProgressTasks || 0, " tasks in progress"] })] }), _jsx("div", { className: "size-10 rounded-lg bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center", children: _jsx("span", { className: "material-symbols-outlined text-blue-600 dark:text-blue-400", children: "sprint" }) })] }) }), _jsx("div", { className: "bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-5 shadow-sm", children: _jsxs("div", { className: "flex items-start justify-between", children: [_jsxs("div", { children: [_jsx("p", { className: "text-sm font-medium text-slate-500 dark:text-slate-400", children: "Open Blockers" }), _jsx("div", { className: "mt-2 flex items-baseline gap-2", children: _jsx("span", { className: `text-3xl font-bold tabular-nums ${(metrics?.openBlockers || 0) > 0 ? 'text-red-600 dark:text-red-400' : 'text-slate-900 dark:text-white'}`, children: metrics?.openBlockers || 0 }) }), _jsxs("div", { className: "mt-2 flex items-center gap-3 text-xs", children: [_jsxs("span", { className: "text-red-600 dark:text-red-400 font-medium", children: [metrics?.criticalBugs || 0, " critical"] }), _jsxs("span", { className: "text-amber-600 dark:text-amber-400 font-medium", children: [metrics?.majorBugs || 0, " major"] })] })] }), _jsx("div", { className: `size-10 rounded-lg flex items-center justify-center ${(metrics?.openBlockers || 0) > 0 ? 'bg-red-100 dark:bg-red-900/30' : 'bg-slate-100 dark:bg-slate-800'}`, children: _jsx("span", { className: `material-symbols-outlined ${(metrics?.openBlockers || 0) > 0 ? 'text-red-600 dark:text-red-400' : 'text-slate-600 dark:text-slate-400'}`, children: "block" }) })] }) }), _jsx("div", { className: "bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-5 shadow-sm", children: _jsxs("div", { className: "flex items-start justify-between", children: [_jsxs("div", { children: [_jsx("p", { className: "text-sm font-medium text-slate-500 dark:text-slate-400", children: "Avg Velocity" }), _jsxs("div", { className: "mt-2 flex items-baseline gap-2", children: [_jsx("span", { className: "text-3xl font-bold text-slate-900 dark:text-white tabular-nums", children: metrics?.avgVelocity || 0 }), _jsx("span", { className: "text-sm text-slate-400 dark:text-slate-500", children: "pts/sprint" })] }), _jsxs("p", { className: "mt-2 text-xs text-slate-500 dark:text-slate-400", children: [metrics?.overdueItems || 0, " overdue items"] })] }), _jsx("div", { className: "size-10 rounded-lg bg-violet-100 dark:bg-violet-900/30 flex items-center justify-center", children: _jsx("span", { className: "material-symbols-outlined text-violet-600 dark:text-violet-400", children: "speed" }) })] }) })] }), _jsxs(motion.div, { variants: fadeInUp, className: "grid grid-cols-5 gap-6", children: [_jsxs("div", { className: "col-span-3 bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-6 shadow-sm", children: [_jsx("div", { className: "flex items-center justify-between mb-6", children: _jsxs("div", { children: [_jsx("h3", { className: "font-bold text-slate-900 dark:text-white", children: "Velocity Trend" }), _jsx("p", { className: "text-sm text-slate-500 dark:text-slate-400", children: "Last 6 completed sprints" })] }) }), _jsx(VelocityChart, { data: velocityTrend, height: 220 })] }), _jsxs("div", { className: "col-span-2 bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-6 shadow-sm", children: [_jsx("div", { className: "flex items-center justify-between mb-6", children: _jsxs("div", { children: [_jsx("h3", { className: "font-bold text-slate-900 dark:text-white", children: "Task Distribution" }), _jsx("p", { className: "text-sm text-slate-500 dark:text-slate-400", children: "By status" })] }) }), _jsx("div", { className: "flex justify-center", children: _jsx(TaskDonutChart, { data: taskDistribution, size: 160, strokeWidth: 20, centerValue: metrics?.totalTasks || 0, centerLabel: "Total" }) })] })] }), _jsxs(motion.div, { variants: fadeInUp, className: "grid grid-cols-2 gap-6", children: [_jsxs("div", { className: "bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden", children: [_jsx("div", { className: "px-6 py-4 border-b border-slate-200 dark:border-slate-800", children: _jsxs("h3", { className: "font-bold text-slate-900 dark:text-white flex items-center gap-2", children: [_jsx("span", { className: "material-symbols-outlined text-red-500 text-[20px]", children: "warning" }), "Risks & Blockers"] }) }), _jsx("div", { className: "max-h-80 overflow-y-auto", children: blockedTasks.length === 0 && criticalBugs.length === 0 && overdueItems.length === 0 ? (_jsxs("div", { className: "p-8 text-center text-slate-400 dark:text-slate-500", children: [_jsx("span", { className: "material-symbols-outlined text-4xl mb-2", children: "check_circle" }), _jsx("p", { children: "No blockers or critical issues" })] })) : (_jsxs("div", { className: "divide-y divide-slate-100 dark:divide-slate-800", children: [blockedTasks.map((task) => (_jsx("div", { className: "px-6 py-3 hover:bg-slate-50 dark:hover:bg-slate-800/50", children: _jsxs("div", { className: "flex items-start gap-3", children: [_jsx("span", { className: "material-symbols-outlined text-red-500 text-[18px] mt-0.5", children: "block" }), _jsxs("div", { className: "flex-1 min-w-0", children: [_jsxs("div", { className: "flex items-center gap-2", children: [_jsx("span", { className: "font-mono text-xs text-slate-400", children: task.issueKey }), _jsx("span", { className: "text-sm font-medium text-slate-900 dark:text-white truncate", children: task.title })] }), _jsx("p", { className: "text-xs text-slate-500 dark:text-slate-400 mt-0.5", children: task.blockedReason || 'No reason specified' }), _jsxs("div", { className: "flex items-center gap-2 mt-1 text-xs text-slate-400", children: [_jsx("span", { children: task.featureName }), _jsxs("span", { className: "text-red-500 font-medium", children: [task.daysBlocked, "d blocked"] })] })] })] }) }, task.taskId))), criticalBugs.map((bug) => (_jsx("div", { className: "px-6 py-3 hover:bg-slate-50 dark:hover:bg-slate-800/50", children: _jsxs("div", { className: "flex items-start gap-3", children: [_jsx("span", { className: "material-symbols-outlined text-red-500 text-[18px] mt-0.5", children: "bug_report" }), _jsxs("div", { className: "flex-1 min-w-0", children: [_jsxs("div", { className: "flex items-center gap-2", children: [_jsx("span", { className: "font-mono text-xs text-slate-400", children: bug.issueKey }), _jsx("span", { className: `px-1.5 py-0.5 text-[10px] font-bold rounded ${bug.severity === 'critical'
                                                                                                ? 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400'
                                                                                                : 'bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400'}`, children: bug.severity?.toUpperCase() })] }), _jsx("p", { className: "text-sm font-medium text-slate-900 dark:text-white truncate mt-0.5", children: bug.title })] })] }) }, bug.id))), overdueItems.slice(0, 5).map((item) => (_jsx("div", { className: "px-6 py-3 hover:bg-slate-50 dark:hover:bg-slate-800/50", children: _jsxs("div", { className: "flex items-start gap-3", children: [_jsx("span", { className: "material-symbols-outlined text-amber-500 text-[18px] mt-0.5", children: "schedule" }), _jsxs("div", { className: "flex-1 min-w-0", children: [_jsxs("div", { className: "flex items-center gap-2", children: [_jsx("span", { className: "font-mono text-xs text-slate-400", children: item.issueKey }), _jsx("span", { className: "text-sm font-medium text-slate-900 dark:text-white truncate", children: item.title })] }), _jsxs("p", { className: "text-xs text-amber-600 dark:text-amber-400 mt-0.5", children: ["Due: ", new Date(item.dueDate).toLocaleDateString()] })] })] }) }, item.id)))] })) })] }), _jsxs("div", { className: "bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden", children: [_jsx("div", { className: "px-6 py-4 border-b border-slate-200 dark:border-slate-800", children: _jsxs("h3", { className: "font-bold text-slate-900 dark:text-white flex items-center gap-2", children: [_jsx("span", { className: "material-symbols-outlined text-blue-500 text-[20px]", children: "groups" }), "Team Productivity"] }) }), _jsx("div", { className: "max-h-80 overflow-y-auto", children: teamProductivity.length === 0 ? (_jsxs("div", { className: "p-8 text-center text-slate-400 dark:text-slate-500", children: [_jsx("span", { className: "material-symbols-outlined text-4xl mb-2", children: "person_off" }), _jsx("p", { children: "No developer data available" })] })) : (_jsx("div", { className: "divide-y divide-slate-100 dark:divide-slate-800", children: teamProductivity.map((member) => (_jsx("div", { className: "px-6 py-3 hover:bg-slate-50 dark:hover:bg-slate-800/50", children: _jsxs("div", { className: "flex items-center justify-between", children: [_jsxs("div", { className: "flex items-center gap-3", children: [_jsx("div", { className: "size-8 rounded-full bg-gradient-to-br from-slate-200 to-slate-300 dark:from-slate-700 dark:to-slate-600 flex items-center justify-center text-xs font-bold text-slate-600 dark:text-slate-300", children: member.name.split(' ').map(n => n[0]).join('') }), _jsxs("div", { children: [_jsx("p", { className: "font-medium text-sm text-slate-900 dark:text-white", children: member.name }), _jsxs("p", { className: "text-xs text-slate-500 dark:text-slate-400", children: [member.inProgress, " in progress"] })] })] }), _jsx("div", { className: "text-right", children: _jsxs("div", { className: "flex items-center gap-4", children: [_jsxs("div", { children: [_jsx("p", { className: "text-lg font-bold text-emerald-600 dark:text-emerald-400 tabular-nums", children: member.tasksCompleted }), _jsx("p", { className: "text-[10px] text-slate-400 uppercase", children: "Done" })] }), _jsxs("div", { children: [_jsx("p", { className: "text-lg font-bold text-slate-900 dark:text-white tabular-nums", children: member.completedPoints }), _jsx("p", { className: "text-[10px] text-slate-400 uppercase", children: "Points" })] })] }) })] }) }, member.userId))) })) })] })] }), _jsxs(motion.div, { variants: fadeInUp, className: "bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden", children: [_jsx("div", { className: "px-6 py-4 border-b border-slate-200 dark:border-slate-800", children: _jsxs("h3", { className: "font-bold text-slate-900 dark:text-white flex items-center gap-2", children: [_jsx("span", { className: "material-symbols-outlined text-violet-500 text-[20px]", children: "flag" }), "Epic Progress Overview"] }) }), _jsx("div", { className: "p-6", children: epics.length === 0 ? (_jsxs("div", { className: "py-8 text-center text-slate-400 dark:text-slate-500", children: [_jsx("span", { className: "material-symbols-outlined text-4xl mb-2", children: "folder_off" }), _jsx("p", { children: "No epics found" })] })) : (_jsx("div", { className: "grid grid-cols-2 gap-6", children: epics.slice(0, 6).map((epic) => (_jsx(RoadmapProgress, { title: epic.title, issueKey: epic.issueKey, progress: epic.progress, targetDate: epic.targetDate || undefined, color: epic.color || undefined }, epic.id))) })) })] }), _jsxs(motion.div, { variants: fadeInUp, children: [_jsxs("h3", { className: "font-bold text-slate-900 dark:text-white mb-4 flex items-center gap-2", children: [_jsx("span", { className: "material-symbols-outlined text-indigo-500 text-[20px]", children: "inventory_2" }), "Products Overview"] }), _jsx("div", { className: "grid grid-cols-4 gap-4", children: products.map((product) => (_jsxs("div", { className: "bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-5 shadow-sm hover:shadow-md hover:border-slate-300 dark:hover:border-slate-700 transition-all cursor-pointer", children: [_jsxs("div", { className: "flex items-center justify-between mb-3", children: [_jsxs("div", { children: [_jsx("p", { className: "font-bold text-slate-900 dark:text-white", children: product.name }), _jsx("p", { className: "text-xs text-slate-400 font-mono", children: product.code })] }), _jsxs("div", { className: `
                        text-2xl font-bold tabular-nums
                        ${product.progress >= 80 ? 'text-emerald-600 dark:text-emerald-400' : ''}
                        ${product.progress >= 50 && product.progress < 80 ? 'text-blue-600 dark:text-blue-400' : ''}
                        ${product.progress < 50 ? 'text-slate-600 dark:text-slate-400' : ''}
                      `, children: [product.progress, "%"] })] }), _jsx("div", { className: "w-full h-2 bg-slate-100 dark:bg-slate-800 rounded-full overflow-hidden", children: _jsx("div", { className: `h-full rounded-full transition-all duration-500 ${product.progress >= 80
                                                                ? 'bg-gradient-to-r from-emerald-500 to-emerald-400'
                                                                : product.progress >= 50
                                                                    ? 'bg-gradient-to-r from-blue-500 to-blue-400'
                                                                    : 'bg-gradient-to-r from-slate-500 to-slate-400'}`, style: { width: `${product.progress}%` } }) }), _jsxs("div", { className: "mt-3 flex items-center justify-between text-xs text-slate-500 dark:text-slate-400", children: [_jsxs("span", { children: [product.epicCount, " epics"] }), _jsxs("span", { children: [product.completedTasks, "/", product.totalTasks, " tasks"] })] })] }, product.id))) })] })] }) })] })] }));
}
